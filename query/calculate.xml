<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="calculate">
    <!-- 미분배된 코인을 확인한다 -->
    <select id="selectNoConfirmCoinList">
        select coin_value, no
        from tb_source_coin
        where confirm_yn != 1
          and coin_type = #{coinType}
          and DATE_FORMAT(mining_time, '%Y-%m-%d') = #{dayStr}
    </select>

    <!-- 미분배 분배 코인 날짜별 확인 -->
    <select id="selectCoinConfirmStatusList">
        select confirm_yn, DATE_FORMAT(mining_time, '%Y-%m-%d') as miningDay, sum(coin_value) coin_value
        from tb_source_coin group by DATE_FORMAT(mining_time, '%Y-%m-%d'), confirm_yn
    </select>

    <!-- 미분배 코인확정 / 미확정 confirm_yn 은 tinyint 이므로 true(1) false(0) 이지 y n 이 아니다. -->
    <update id="updateCoinSource">
        update tb_source_coin
        set confirm_yn = #{confirmYn}
        where no = #{no}

    </update>

    <!-- 추천인 목록추출 3차까지 뒤져야 하지만 쿼리는 단순! 디비구조 단순! 부속정보는 무조건 별도로! 지켜야함! 이렇게 적는 이유는 다음관리자들이 컬럼 마구잡이로 추가하고 이런 실수 하지 말도록!-->
    <select id="selectRecommendList">
        select * from tb_user_recommend
    </select>
</mapper>